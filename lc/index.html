<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sign in</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/8bahtapp/web-images/refs/heads/main/favicon.png">
    <link rel="stylesheet" href="/th/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body class="home-page">
    <header class="main-header">
        <div class="header-container">
            <div class="header-left">
                <button class="mobile-menu-btn" id="mobile-toggle">
                    <span></span><span></span><span></span>
                </button>

                <a href="/th/" class="logo-wrapper">
                    <img src="https://raw.githubusercontent.com/8bahtapp/web-images/refs/heads/main/icon-8baht.png" alt="8Baht" class="logo">
                </a>

                <nav class="desktop-menu" id="main-nav">
                    <a href="/th/adobe/">Adobe</a>
                    <a href="/th/autodesk/">Autodesk</a>
                    <a href="/th/sketchup/">SketchUp</a>
                    <a href="/th/rhino/">Rhino</a>
                    <a href="/th/bimbundle/">BIM Bundle</a>
                    <a href="/th/corona/">Corona</a>
                    <a href="/th/enscape/">Enscape</a>
                    <a href="/th/vray/">V-Ray</a>
                    <a href="/th/d5/">D5</a>
                    <a href="/th/lumion/">Lumion</a>
                    <a href="/th/foxit/">Foxit</a>
                    <a href="/th/pdfelement/">PDFelement</a>
                    <a href="/th/microsoft/">Microsoft</a>
                    <a href="/th/gstarcad/">GstarCAD</a>
                    <a href="/th/other/">อื่นๆ</a>
                </nav>
            </div>

            <div class="header-right">
                <div class="toggle-container">
                  <button class="toggle-button" id="theme-toggle-switch">
                    <span class="toggle-circle"></span>
                  </button>
                </div>
                <a href="https://8baht.com/help" class="btn-ticket" target="_blank">Open Ticket</a>
            </div>
        </div>
    </header>

    <main style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 20px;">
    
        <div style="text-align: center; background: rgba(255,255,255,0.05); padding: 40px; border-radius: 15px; border: 1px solid rgba(128,128,128,0.2); width: 100%; max-width: 400px;">
            <h2 style="margin-bottom: 20px; font-family: sans-serif;">Sign in</h2>
        
            <div style="display: flex; justify-content: center;">
                <div id="g_id_onload"
                     data-client_id="61210469646-gjf7ajhrd4p3hr981ofnen7u3bcd8m8n.apps.googleusercontent.com"
                     data-callback="handleCredentialResponse">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="signin_with"
                     data-shape="pill" 
                 data-logo_alignment="left">
                </div>
            </div>
        </div>

    </main>

    <footer class="main-footer">
        <p>Copyright © 2026 8Baht Support. All rights reserved.</p>
    </footer>

    <script src="../theme-manager.js"></script>
    <script src="../script.js"></script>

    <script>
        function parseJwt(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        async function handleCredentialResponse(response) {
            const responsePayload = parseJwt(response.credential);
            const email = responsePayload.email;
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbxK5lJ1Mk_2IaFBdixCRTs-qXEao3V8wMUjKh8988UC2uGRVVDVnqcdmgyERb7q8qJ4qw/exec';

            console.log("Checking permissions for:", email);

            try {
                const res = await fetch(`${scriptUrl}?email=${encodeURIComponent(email)}`);
                const data = await res.json();

                if (data.role === 'support' || data.role === 'sale') {
                    localStorage.setItem('userEmail', email);
                    localStorage.setItem('userRole', data.role);
                    
                    if (data.role === 'support') {
                        window.location.href = 'https://8bahtapp.github.io/th/lc/support';
                    } else {
                        window.location.href = 'https://8bahtapp.github.io/th/lc/sale';
                    }
                } else {
                    console.warn('Unauthorized access attempt:', email);
                    alert('ขออภัย อีเมล ' + email + ' ไม่มีสิทธิ์เข้าถึงระบบ');
                }
            } catch (error) {
                console.error("Fetch error:", error);
                alert('เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล กรุณาลองใหม่');
            }
        }
    </script>
</body>
</html>
